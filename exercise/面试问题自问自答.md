# 刻意练习

[toc]

## 多线程

### 当提交一个线程任务时，线程池是如何工作的？

问题拆解两部分回答此问题，线程池的参数构成；提交线程任务后参数的变化影响线程工作流程是怎样的。

1. 线程池的核心参数有：核心线程数、最大线程数、空闲线程存活时间、时间单位、任务队列、线程工厂、拒绝策略等参数；

2. 其中核心参数的设置，根据并发任务是什么类型的，如果是cpu密集型任务，则分配核心线程数为N+1；如果是I/O密集型的任务，则分配核心线程数为2N

3. 当提交一个线程任务时

   1. 首先检测线程池运行状态，如果不是RUNNING，则直接拒绝，线程池要保证在RUNNING的状态下执行任务。
   2. 如果workerCount < corePoolSize，则创建并启动一个线程来执行新提交的任务。
   3. 如果workerCount >= corePoolSize，且线程池内的阻塞队列未满，则将任务添加到该阻塞队列中。
   4. 如果workerCount >= corePoolSize && workerCount < maximumPoolSize，且线程池内的阻塞队列已满，则创建并启动一个线程来执行新提交的任务。
   5. 如果workerCount >= maximumPoolSize，并且线程池内的阻塞队列已满, 则根据拒绝策略来处理该任务, 默认的处理方式是直接抛异常。

   ![](../image/任务调度流程图.png)

## JVM

### 类的加载过程是怎么样的？

1. 类的加载过程：加载、链接、初始化、使用、卸载，其中链接又分为 验证、验证、分析三个步骤
2. 加载：在内存中生成一个代表该类的 `Class` 对象，作为方法区这些数据的访问入口
3. 验证：文件格式验证、元数据验证、字节码验证、符号引用验证
4. 准备：**准备阶段是正式为类变量分配内存并设置类变量初始值的阶段**，这些内存都将在方法区中分配
5. 分析：解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程。解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用限定符 7 类符号引用进行。
6. 初始化：初始化阶段是执行初始化方法 `<clinit> ()`方法的过程，是类加载的最后一步，这一步 JVM 才开始真正执行类中定义的 Java 程序代码(字节码)。
7. 卸载：Class对象被GC

## Spring框架

### Spring如何解决循环依赖的？

Spring通过将实例化后的对象提前暴露给Spring容器中的singletonFactories，解决了循环依赖的问题。

具体实现是通过Spring初始化bean的时候，会经过三个缓存Map来存放bean，它们分别是：

* singletonObjects里面存放的是初始化之后的单例对象。
* earlySingletonObjects中存放的是一个已完成实例化未完成初始化的早期单例对象。
* singletonFactories中存放的是ObjectFactory对象，此对象的getObject方法返回值即刚完成实例化还未开始初始化的单例对象。
* 它们的先后顺序是，**单例对象先存在于singletonFactories中，后存在于earlySingletonObjects中，最后初始化完成后放入singletonObjects中**。

## 项目

### 项目中如何支撑高并发的？

项目中应用的是分布式架构支撑的，通过redis集群构建项目的缓存层；前端到服务之间是使用的zookeeper集群+dubbo微服务的方式进行调用；项目架构采用的是前后端分离的方式，将静态文件放在nginx服务器集群上；数据库层面使用的是DB2数据库，还有部分项目使用的MySQL数据库等。



## MySQL

### MySQL的索引结构？

B+树，什么是B+树？ 为什么使用B+树？

* 理解B+前提要知道B树（也就是B-树），理解B-树的前提要知道平衡二叉树。
* 何为平衡二叉树？平衡二叉树是基于二分法的策略提高数据的查找速度的二叉树的数据结构；特点：非叶子节点只能允许最多两个子节点存在；每一个非叶子节点数据分布规则为左边的子节点小于当前节点的值，右边的子节点大于当前节点的值；树的两边的层级想差不会大于1；没有值相等重复的节点。
* 何为B树？B树和平衡二叉树稍有不同的是B树属于多叉树又名平衡多路查找树（查找路径不只有两个）。特点：所有子节点是按递增次序排列，并遵循左小右大原则；非叶节点的子节点数>1，且<=M，且M>=2，空树除外（M阶代表一个树节点最多有多少个查找路径，M=M路，当M=2则是2叉树，M=3则是3叉）；枝节点的关键字数量大于等于ceil(m/2)-1个且小于等于M-1个（ceil()是朝正无穷方向取整的函数如ceil(1.1)结果为2）；叶子节点均在同一层、叶子除了包含关键字和关键字记录的指针外也有指向其子节点的指针只不过其指针地址都为null。

### 创建索引时需要考虑哪些因素？哪些字段可以作为索引字段？

### 使用索引时需要注意什么？

## 设计模式

### 单例模式双重检验锁 为什么要双重校验？

双锁模式指在懒汉模式的基础上做进一步优化，给静态对象的定义加上volatile锁来保障初始化时对象的唯一性，在获取对象时通过synchronized (Singleton.class)给单例类加锁来保障操作的唯一性。
